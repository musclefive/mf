
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!--IE 兼容性-->
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>VWEDCC 日常量查询</title>

    <!-- Load JavaScript Libraries -->
    <script src="../js/jquery-2.1.1.js"></script>
    <script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../js/jsTool.js" type="text/javascript"></script>
    <script src="../js/jquery.blockUI.js" type="text/javascript"></script>
    <script src="../js/datatable/jquery.dataTables.js" type="text/javascript"></script>
    <script src="../js/datatable/dataTables.bootstrap.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/datatable/dataTables.bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../css/datatable/buttons.bootstrap.css">
    <style type="text/css">
        .blur {
            border: 1px solid red;
        }
    </style>
    <script language="javascript">
        var table;
        $(document).ready(function() {
            table = $('#userList').DataTable({
//                dom: "Bfrtip",
                "bProcessing": true,
                "ajax": {
                    "url" : "/momo/queryDomainUser?method=query",
                    "dataSrc" : "items"
                },
                stateSave: true,
                //根据第四列用户的权限进行默认排序
                aaSorting : [[4, 'desc']],
                "aoColumns": [
                    {
                        "bSortable": false,
                        "data": null,
                        "defaultContent": "<input type='checkbox' class='ace'>"

                    },
                    {
                        "data": "sAMAccountName",
                        "bSortable": false
                    },
                    { "data": "mail" },
//						{ "data": "whenCreated" },
                    { "data": "department" },
                    {
                        "data": "userDescript",
                        "bSortable": false

                    },
                    {
                        "bSortable": false,
                        "targets": -1,
                        "data": null,
                        "defaultContent": "<button class='btn btn-xs btn-info btn-edit' title='updatePermission'>编辑</button>"
                    }
                ],
                "fnCreatedRow": function( nRow, aData, iDataIndex ) {
                    // 为a的话字体加粗
//                    if ( aData["department"] == "VWED IT" )
//                    {
                        var text = "<input class='form-control'  name='duration' type='text' value='"+aData["userDescript"] + "'/>";
                        console.info("data:" + aData["userDescript"] + " " + nRow + " " + iDataIndex + " text: " + text);
                        $('td:eq(3)', nRow).html( text );
//                    }
                }
            });

            $("#btnTest").click(function (e){
                var alldata=$('#userList').dataTable().fnGetData();
//                console.info(alldata);
//                console.info($("tr"));
            });

            $(document).on('click', 'th input:checkbox' , function(){
                var that = this;
                $(this).closest('table').find('tr > td:first-child input:checkbox')
                        .each(function(){
                            this.checked = that.checked;
                            $(this).closest('tr').toggleClass('selected');
                        });
            });

            $("#btnTest").on("click",function(){
//                var row=table.row($(this).parents("tr"));
//                var tds=$(this).parents("tr").children();
//                var data=row.data();
//                var data = table.row( $(this).parents('tr') ).data();
                $('#userList').find('tr > td:first-child input:checkbox').each(function(){
                    if(this.checked == true){
                        //构建jquery datatable row 数据
                        var tr = $(this).closest("tr");
                        //包含input的cell
                        var cell = tr.find("input:last").closest("td");
                        //新录入的input text
                        var inputVal = tr.find("input:last").val();
                        //将新录入的文字转换到jquery datatable
//                        cell.html(inputVal);
//                        table.cell(cell).data(inputVal);

                        //获取改行的数据
                        var data = table.row(tr).data();
                        console.info(data["userDescript"]+ " inputVal:" + inputVal);

                        var jsonData = "DT_RowId="+data["DT_RowId"] + "&userDescript="+inputVal;

                        $.ajax({
                            "url":"/momo/shiftManage",
                            "data":jsonData,
                            "type":"post",
                            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                            error : function (xhr, textStatus){
                                console.info("ajax error,textStatus:" + textStatus);
                            },
                            "success":function(data){
                                console.info("success" + data);
                                tr.find("input:last").addClass("blur");
                            }
                        });

                    }else{
                        console.info("no checked");
                    }
                });


//                var data = table.row( $(this)).data();
//
//                console.info(data["userDescript"]+ " " );
//                $.each(tds, function(i,val){
//                    var jqob=$(val);
//                    //把input变为字符串
//                    if(!jqob.has('button').length){
//                        var txt=jqob.children("input").val();
//                        jqob.html(txt);
//                        table.cell(jqob).data(txt);//修改DataTables对象的数据
//                    }
//                });
//                var data=row.data();
//                $.ajax({
//                    "url":"/example/resources/user_share/inline_edit_no_plugin/edit.php",
//                    "data":data,
//                    "type":"post",
//                    "error":function(){
//                        alert("服务器未正常响应，请重试");
//                    },
//                    "success":function(response){
//                        alert(response);
//                    }
//                });
//                $(this).html("编辑");
//                $(this).toggleClass("edit-btn");
//                $(this).toggleClass("save-btn");
            });

        });

    </script>
</head>
<body>
<div class="container">
    <!--head blank start-->
    <div class="row clearfix">
        <div class="col-md-4">
            <h1>
                <span>日常量查询</span>
                <button type="button" class="btn-default" value="Text" id="btnTest">CC</button>
            </h1>
        </div>
        <div class="col-md-4">
            <h1>
                <span>日常量查询</span>
            </h1>
        </div>
        <div class="col-md-4">
            <h1>
                <span>日常量查询</span>
            </h1>
        </div>
    </div>
    <div class="row clearfix">
        <br/>
    </div>
    <div class="row clearfix">
    </div>
    <div class="row clearfix">
        <div class="col-md-12">
            <h3>用户列表</h3>
            <!--<table class="table table-striped table-bordered" id="userList">-->
            <table class="table table-striped table-bordered" id="userList" width="100%" cellspacing="0">
                <thead>
                <tr>
                    <th class="center-block">
                        <input type="checkbox" class="ace">
                    </th>
                    <!--<th>distinguishedName</th>-->
                    <th>sAMAccountName</th>
                    <th>mail</th>
                    <!--<th>title</th>-->
                    <!--<th>telephoneNumber</th>-->
                    <!--<th>whenCreated</th>-->
                    <!--<th>physicalDeliveryOfficeName</th>-->
                    <!--<th>name</th>-->
                    <!--<th>mailNickname</th>-->
                    <th>department</th>
                    <th>Role</th>

                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

</div>
</body>
</html>
