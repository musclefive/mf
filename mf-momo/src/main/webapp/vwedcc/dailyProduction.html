<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>每日产量图表 - MOMO 系统</title>

		<meta name="description" content="" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" href="../assets/css/bootstrap.min.css" />
		<!--<link rel="stylesheet" href="../assets/css/font-awesome.min.css" />-->
		<link rel="stylesheet" href="../assets/css/font-awesome.min.css" />
		<link rel="shortcut icon" href="../img/logo.ico" type="image/x-icon" />

		<!-- page specific plugin styles -->
		<link rel="stylesheet" href="../css/bootstrap-datetimepicker.css" />
		<link rel="stylesheet" href="../css/jquery.raty.css" />
		<link rel="stylesheet" type="text/css" href="../css/datatable/dataTables.bootstrap.css">
		<link rel="stylesheet" type="text/css" href="../css/datatable/buttons.bootstrap.css">
		<link rel="stylesheet" type="text/css" href="../css/datatable/TableTools.css">

		<!-- text fonts -->
		<link rel="stylesheet" href="../assets/css/ace-fonts.css" />

		<!-- ace styles -->
		<link rel="stylesheet" href="../assets/css/ace.min.css" id="main-ace-style" />

		<!--[if lte IE 9]>
			<link rel="stylesheet" href="../assets/css/ace-part2.min.css" />
		<![endif]-->
		<link rel="stylesheet" href="../assets/css/ace-skins.min.css" />
		<link rel="stylesheet" href="../assets/css/ace-rtl.min.css" />

		<!--[if lte IE 9]>
		  <link rel="stylesheet" href="../assets/css/ace-ie.min.css" />
		<![endif]-->

		<!-- inline styles related to this page -->

		<!-- ace settings handler -->
		<script src="../assets/js/ace-extra.min.js"></script>

		<!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

		<!--[if lte IE 8]>
		<script src="../assets/js/html5shiv.min.js"></script>
		<script src="../assets/js/respond.min.js"></script>
		<![endif]-->
	</head>

	<body class="no-skin">
		<!-- #section:basics/navbar.layout -->
		<div id="navbar" class="navbar navbar-default">
			<script type="text/javascript">
				try{ace.settings.check('navbar' , 'fixed')}catch(e){}
			</script>

			<div class="navbar-container" id="navbar-container">
				<!-- #section:basics/sidebar.mobile.toggle -->
				<button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler">
					<span class="sr-only">Toggle sidebar</span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>
				</button>

				<!-- /section:basics/sidebar.mobile.toggle -->
				<div class="navbar-header pull-left">
					<div class="navbar-header pull-left">
						<!-- #section:basics/navbar.layout.brand -->
						<img src="../img/logon.png" style="width: 81px;height: 45px;float:left">
						<a href="#" class="navbar-brand">
							<small>
								MOMO 目视化系统
							</small>
						</a>
					</div>
					<!-- /section:basics/navbar.toggle -->
				</div>

				<!-- #section:basics/navbar.dropdown -->
				<div class="navbar-buttons navbar-header pull-right" role="navigation">
					<ul class="nav ace-nav">
						<!-- #section:basics/navbar.user_menu -->
						<li class="light-blue">
							<a data-toggle="dropdown" href="#" class="dropdown-toggle">
								<!--<img class="nav-user-photo" src="../assets/avatars/user.jpg" alt="Jason's Photo" />-->
								<span class="user-info" style="max-width: 200px">
									<small>Welcome,</small>
									<!--<div id="divUserRoleDescript">admin</div>-->
									<div id="divUserName"></div>
								</span>
							</a>
						</li>
						<!-- /section:basics/navbar.user_menu -->
					</ul>
				</div>

				<!-- /section:basics/navbar.dropdown -->
			</div><!-- /.navbar-container -->
		</div>

		<!-- /section:basics/navbar.layout -->
		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<!-- #section:basics/sidebar -->
			<div id="sidebar" class="sidebar                  responsive">
				<script type="text/javascript">
					try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
				</script>

				<div class="sidebar-shortcuts" id="sidebar-shortcuts">
					<div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
						<button class="btn btn-success">
							<i class="ace-icon fa fa-signal"></i>
						</button>

						<button class="btn btn-info">
							<i class="ace-icon fa fa-pencil"></i>
						</button>

						<!-- #section:basics/sidebar.layout.shortcuts -->
						<button class="btn btn-warning">
							<i class="ace-icon fa fa-users"></i>
						</button>

						<button class="btn btn-danger">
							<i class="ace-icon fa fa-cogs"></i>
						</button>

						<!-- /section:basics/sidebar.layout.shortcuts -->
					</div>

					<div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
						<span class="btn btn-success"></span>

						<span class="btn btn-info"></span>

						<span class="btn btn-warning"></span>

						<span class="btn btn-danger"></span>
					</div>
				</div><!-- /.sidebar-shortcuts -->

				<ul class="nav nav-list">
					<li class="" id="liDashboard" style="display: none">
						<a href="index.html">
							<i class="menu-icon fa fa-tachometer"></i>
							<span class="menu-text"> 首页 </span>
						</a>

						<b class="arrow"></b>
					</li>

					<li class="active" id="liDailyProduction" style="display: none">
						<a href="dailyProduction.html">
							<i class="menu-icon fa fa-desktop"></i>
							<span class="menu-text"> 每日产量图表 </span>
						</a>
						<b class="arrow"></b>

					</li>

					<li class="" id="liHistoryProduction" style="display: none">
						<a href="historyProduction.html" >
							<i class="menu-icon fa fa-list"></i>
							<span class="menu-text"> 历史产量图表 </span>
						</a>
						<b class="arrow"></b>

					</li>

					<li class="" id="liPlanManage" style="display: none">
						<a href="planManage.html">
							<i class="menu-icon fa fa-pencil-square-o"></i>
							<span class="menu-text"> 生产计划维护 </span>

						</a>

						<b class="arrow"></b>

					</li>

					<li class="" id="liBreakQuery" style="display: none">
						<a href="breakQuery.html">
							<i class="menu-icon fa fa-calendar"></i>

							<span class="menu-text">
								设备报警查询

								<!-- #section:basics/sidebar.layout.badge -->
								<span class="badge badge-transparent tooltip-error">
									<i class="ace-icon fa fa-exclamation-triangle red bigger-130"></i>
								</span>

								<!-- /section:basics/sidebar.layout.badge -->
							</span>
						</a>

						<b class="arrow"></b>
					</li>

					<li class="" id="liShiftManage" style="display: none">
						<a href="shiftManage.html" >
							<i class="menu-icon fa fa-tag"></i>

							<span class="menu-text">
								班次信息维护
							</span>

						</a>
					</li>

					<li class="" id="liUserList" style="display: none">
						<a href="userList.html" class="">
							<i class="menu-icon ace-icon fa fa-user"></i>
							<span class="menu-text"> 用户权限维护 </span>

						</a>

						<b class="arrow"></b>

					</li>

				</ul><!-- /.nav-list -->

				<!-- #section:basics/sidebar.layout.minimize -->
				<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
					<i class="ace-icon fa fa-angle-double-left" data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
				</div>

				<!-- /section:basics/sidebar.layout.minimize -->
				<script type="text/javascript">
					try{ace.settings.check('sidebar' , 'collapsed')}catch(e){}
				</script>
			</div>

			<!-- /section:basics/sidebar -->
			<div class="main-content">
				<!-- #section:basics/content.breadcrumbs -->
				<div class="breadcrumbs" id="breadcrumbs">
					<script type="text/javascript">
						try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
					</script>

					<ul class="breadcrumb">
						<li>
							<i class="ace-icon fa fa-home home-icon"></i>
							<a href="#">Home</a>
						</li>

						<li class="active">每日产量图表</li>
					</ul><!-- /.breadcrumb -->
				</div>

				<!-- /section:basics/content.breadcrumbs -->
				<div class="page-content">
					<!-- #section:settings.box -->
					<div class="ace-settings-container" id="ace-settings-container">
						<div class="btn btn-app btn-xs btn-warning ace-settings-btn" id="ace-settings-btn">
							<i class="ace-icon fa fa-cog bigger-150"></i>
						</div>

						<div class="ace-settings-box clearfix" id="ace-settings-box">
							<div class="pull-left width-50">
								<!-- #section:settings.skins -->
								<div class="ace-settings-item">
									<div class="pull-left">
										<select id="skin-colorpicker" class="hide">
											<option data-skin="no-skin" value="#438EB9">#438EB9</option>
											<option data-skin="skin-1" value="#222A2D">#222A2D</option>
											<option data-skin="skin-2" value="#C6487E">#C6487E</option>
											<option data-skin="skin-3" value="#D0D0D0">#D0D0D0</option>
										</select>
									</div>
									<span>&nbsp; Choose Skin</span>
								</div>

								<!-- /section:settings.skins -->

								<!-- #section:settings.navbar -->
								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-navbar" />
									<label class="lbl" for="ace-settings-navbar"> Fixed Navbar</label>
								</div>

								<!-- /section:settings.navbar -->

								<!-- #section:settings.sidebar -->
								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-sidebar" />
									<label class="lbl" for="ace-settings-sidebar"> Fixed Sidebar</label>
								</div>

								<!-- /section:settings.sidebar -->

								<!-- #section:settings.breadcrumbs -->
								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-breadcrumbs" />
									<label class="lbl" for="ace-settings-breadcrumbs"> Fixed Breadcrumbs</label>
								</div>

								<!-- /section:settings.breadcrumbs -->

								<!-- #section:settings.rtl -->
								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-rtl" />
									<label class="lbl" for="ace-settings-rtl"> Right To Left (rtl)</label>
								</div>

								<!-- /section:settings.rtl -->

								<!-- #section:settings.container -->
								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-add-container" />
									<label class="lbl" for="ace-settings-add-container">
										Inside
										<b>.container</b>
									</label>
								</div>

								<!-- /section:settings.container -->
							</div><!-- /.pull-left -->

							<div class="pull-left width-50">
								<!-- #section:basics/sidebar.options -->
								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-hover" />
									<label class="lbl" for="ace-settings-hover"> Submenu on Hover</label>
								</div>

								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-compact" />
									<label class="lbl" for="ace-settings-compact"> Compact Sidebar</label>
								</div>

								<div class="ace-settings-item">
									<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-highlight" />
									<label class="lbl" for="ace-settings-highlight"> Alt. Active Item</label>
								</div>

								<!-- /section:basics/sidebar.options -->
							</div><!-- /.pull-left -->
						</div><!-- /.ace-settings-box -->
					</div><!-- /.ace-settings-container -->

					<!-- /section:settings.box -->
					<div class="page-content-area">
						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
								<div class="tabbable">
									<ul class="nav nav-tabs" id="myTab">
										<li class="active">
											<a data-toggle="tab" href="#user">
												<i class="green ace-icon fa fa-bar-chart-o bigger-120"></i>
												每日产量图示
											</a>
										</li>

										<li class="">

											<a data-toggle="tab" href="#group">
												<i class="red ace-icon fa  fa-gavel bigger-120"></i>
												停台统计查询
											</a>
										</li>

									</ul>

									<div class="tab-content">
										<div id="user" class="tab-pane fade active in">
											<form action="" class="form-horizontal"  role="form">
												<label for="query_date" class="col-md-2 control-label">选择日期</label>
												<div class="input-group col-md-4" >
													<input id="date-timepicker1" type="text" class="form-control" />
													<!--<span class="input-group-addon"><span class="glyphicon glyphicon-search" id="btnSearch"></span></span>-->
													<span class="input-group-btn">
														<button type="button" id="btnSearch" class="btn btn-purple btn-sm" name="btnSearch">
															Search
															<i class="ace-icon fa fa-search icon-on-right bigger-110"></i>
														</button>
													</span>
												</div>
												<input type="hidden" id="query_date" name="query_date" value="" />
											</form>
											<div id="chartPanel"></div>
										</div>
										<div id="group" class="tab-pane fade">
											<table id="tableBreakInfo" class="table table-striped table-bordered" cellspacing="0" width="100%">
											</table>
										</div>
									</div>
								</div>

								<!-- PAGE CONTENT ENDS -->
								<!--Model for break down information Start-->
								<div class="modal fade" id="breakModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header">
												<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
												<h4 class="modal-title" id="myModalLabel">
													<label id="breakDayInfo"></label> 管理停台信息
												</h4>
											</div>
											<div class="modal-body">
												<form action="" class="form-horizontal" id="formBreakdown" method="post"  role="form">
													<fieldset>
														<div class="form-group">
															<label for="breakStartTime" class="col-md-3 control-label">Start Time</label>
															<div class="col-md-6">
																<input class="form-control" id="breakStartTime" name="breakStartTime" type="text" value="" readonly/>
															</div>
														</div>
														<div class="form-group">
														<label for="timePickerBreakEndTime" class="col-md-3 control-label">End Time</label>
														<div class="col-md-6">
															<!--<div class="input-group date form_time col-md-6" id="timePicker"-->
															<!--data-date="" data-date-format="yyyy-mm-dd hh:ii"-->
															<!--data-link-field="breakEndTime" data-link-format="yyyy-mm-dd hh:ii">-->
															<!--<input class="form-control" size="50" type="text" value="" id="endTime">-->
															<!--<span class="input-group-addon"><span class="glyphicon glyphicon-time"></span></span>-->
															<!--</div>-->
															<div class="input-group col-md-9" >
																<input id="timePickerBreakEndTime" name="timePickerBreakEndTime" type="text" class="form-control"/>
																<span class="input-group-addon"><i class="fa fa-clock-o bigger-110"></i></span>
															</div>
															<input type="hidden" id="breakEndTime" value=""  name="breakEndTime"/>
															<input type="hidden" id="breakNO" value=""  name="breakNO"/>
															<input type="hidden" id="breakScope" value=""  name="breakScope"/>
															</div>
														</div>

														<div class="form-group">
															<label for="duration" class="col-md-3 control-label">Duration</label>
															<div class="col-md-6">
																<input class="form-control" id="duration" name="duration" type="text" disabled/>
																<input type="hidden" id="breakDuration" value=""  name="breakDuration"/>
															</div>
														</div>
														<div class="form-group">
															<label for="divRating" class="col-md-3 control-label">Level</label>
															<div class="col-md-6">
																<div id="divRating" data-score="3"></div><div id="hint"></div>
															</div>
															<input type='hidden' name='breakLevel' id="breakLevel" value='3' />
														</div>
														<div class="form-group">
															<label class="col-md-3 control-label">Type</label>
															<div class="col-md-6 controls">
																<select id="breakType" name="breakType" class="form-control">
																	<option value="">请选择</option>
																	<option value="1">设备故障</option>
																	<option value="2">物料短缺</option>
																	<option value="3">其他</option>
																</select>
															</div>
														</div>
														<div class="form-group">
															<label class="col-md-3 control-label" for="breakReason">Reason</label>
															<div class="col-md-6 controls">
																<!--<input placeholder="Reason for Breakdown" class="form-control" id="breakReason" type="text"-->
																	   <!--name="breakReason" maxlength="50">-->
																<textarea class="input-xlarge form-control" maxlength="100" rows="3" cols="10"
																		  name="breakReason" id="breakReason"></textarea>
															</div>
														</div>
													</fieldset>
												</form>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn " data-dismiss="modal" id="btnClose">Close</button>
												<button type="button" class="btn btn-primary" id="btnSubmit" name="btnSubmit">Add</button>
												<button type="button" class="btn btn-primary" id="btnDelete"  name="btnDelete" value="">Delete</button>
												<button type="button" class="btn btn-danger" id="btnUpdate"  name="btnUpdate" value="">Update</button>
											</div>
										</div>
									</div>
								</div>
								<!--Model for break down information End-->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content-area -->
				</div><!-- /.page-content -->
			</div><!-- /.main-content -->

			<div class="footer">
				<div class="footer-inner">
					<!-- #section:basics/footer -->
					<div class="footer-content">
						<span class="bigger-120">
							<span class="blue bolder"></span>
							Stone Info &copy; 2015-2016
						</span>

						&nbsp; &nbsp;
					</div>

					<!-- /section:basics/footer -->
				</div>
			</div>

			<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
				<i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
			</a>
		</div><!-- /.main-container -->

		<!-- basic scripts -->

		<!--[if !IE]> -->
		<script type="text/javascript">
			window.jQuery || document.write("<script src='../assets/js/jquery.min.js'>"+"<"+"/script>");
		</script>

		<!-- <![endif]-->

		<!--[if IE]>
        <script type="text/javascript">
         window.jQuery || document.write("<script src='../assets/js/jquery1x.min.js'>"+"<"+"/script>");
        </script>
        <![endif]-->
		<script type="text/javascript">
			if('ontouchstart' in document.documentElement) document.write("<script src='../assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="../assets/js/bootstrap.min.js"></script>
		<script src="../js/jquery.raty.js" type="text/javascript"></script>
		<!-- page specific plugin scripts -->

		<!-- ace scripts -->
		<script src="../assets/js/ace-elements.min.js"></script>
		<script src="../assets/js/ace.min.js"></script>

		<!-- inline scripts related to this page -->

		<script src="../js/highcharts.src.js" type="text/javascript"></script>
		<script src="../assets/js/date-time/moment.js" type="text/javascript"></script>
		<script src="../js/jsTool.js" type="text/javascript"></script>
		<script src="../assets/js/date-time/bootstrap-datetimepicker.js" type="text/javascript"></script>
		<script src="../js/jquery.blockUI.js" type="text/javascript"></script>
		<script src="../js/jquery.validate.js" type="text/javascript"></script>
		<script src="../js/jquery.cookie.js" type="text/javascript"></script>
		<script src="../js/datatable/jquery.dataTables.js" type="text/javascript"></script>
		<script src="../js/datatable/dataTables.bootstrap.js" type="text/javascript"></script>
		<script src="../js/datatable/TableTools.js" type="text/javascript"></script>
		<script src="../js/datatable/ZeroClipboard.js" type="text/javascript"></script>
		<!-- user define js script -->
		<script type="text/javascript">
			var val_actual = new Array();
			var val_opr = new Array();
			var val_roa = new Array();
			var val_time = new Array();
			var val_time_int = new Array();
			var tableBreakInfo;
			var validator;
			var userName ;
			try {
				var WshShell = new ActiveXObject("WScript.Shell");
//				document.write("计算机名 = " + WshShell.ExpandEnvironmentStrings("%USERNAME%") + "<br/>");
				userName = WshShell.ExpandEnvironmentStrings("%USERNAME%");

				console.info("userName from WSHSHELL " + userName);
			}catch(e){
				//				alert("请更改浏览器配置");
				console.info("can't get user name from wscript.shell");
				location.href = "errorPage.html";
			}
			//评分插件
			var starOptions = {
				score: 3,
				path:  "../img",
				hints: ['一般','严重', '一般严重', '非常严重', '极其严重'],
				target : '#hint',
				targetKeep : true,
				click: function(score, evt) {
//                    alert('ID: ' + this.id + "\nscore: " + score + "\nevent: " + evt);
					$("#breakLevel").val(score);
				}
			};
			$.blockUI.defaults.message = '<h4><img style="height: 30px;width: 30px" src="../img/loading.gif" /> Just a moment...</h4>';
			$.blockUI.defaults.overlayCSS.opacity = .2;
			$(document).ajaxStart($.blockUI).ajaxStop($.unblockUI);
			$(function () {

//				var userName = "chao.cui.vwed";
				if($.cookie("userName") ==  undefined){
					//userName 没在cookie里 则去数据库中取用户信息
					getUserNameAndRole(userName);
				}else{
					//使用cookie信息获取用户信息 设置页面右上角信息
					var temp = $.cookie("userDescript") + " " + $.cookie("showName");
					console.info("user info in cookie" + temp + " " + $.cookie("userRole"));
					$("#divUserName").html(temp);
					menuRight($.cookie("userRole"));
				}

				val_actual = [];
				val_opr = [];
				val_roa = [];
				val_time = [];
				var today = new Date();
				var longToday  = Date.UTC(today.getFullYear(), today.getMonth(), today.getDate());
				var yesterday = new Date(longToday - 86400000);
				var month = yesterday.getMonth() + 1;
				var endDate = yesterday.getFullYear()+"-"+month+"-"+yesterday.getDate();
				var startYear = today.getFullYear() + "-01-01";
				var endYear = today.getFullYear() + "-12-31";
				console.info("query endDate:" + endDate);

				//在页面内第一个点击Tab 页 进行数据查询，并显示数据
				$('a[href="#group"]').on('shown.bs.tab', function (e) {

					if(tableBreakInfo){
						$('#tableBreakInfo').dataTable().fnDestroy();
					}
					initTableList();
				});

				//评分插件
				$("#divRating").raty(starOptions);
				$("#btnSearch").click(function(){
					//endDate 是查询的日期
					var endDate = $("#query_date").val();
					console.info("endDate:" + endDate);
					//弹出遮罩层
					$.blockUI();
					queryData(options , endDate);
				});
				//日期插件 格式2014-10-12 默认只能选一年以内的时间
				$('#date-timepicker1').datetimepicker({
					format : 'YYYY-MM-DD dddd',
					viewMode : 'days',
					showClose : true,
					calendarWeeks : true,
					showTodayButton : true,
					maxDate : endYear,
					minDate : startYear
				}).on("dp.change", function (e){
					$("#query_date").val(moment(e.date).format("YYYY-MM-DD"));
					console.info("datetimepicker on change event: " + moment(e.date).format("YYYY-MM-DD"));
				});

				//校验控件
				validator = $('#formBreakdown').validate({
					errorElement: 'div',
					errorClass: 'help-block',
					focusInvalid: false,
					rules: {
						timePickerBreakEndTime: {
							required: true
						},

						breakType: {
							required: true
						},
						breakReason: {
							required: true
						},
						breakDuration: {
							required: true
						}
					},

					messages: {
						timePickerBreakEndTime: {
							required: "选择停台结束时间"
						},
						breakReason: {
							required: "添加停台原因"
						},
						breakType: "选择停台故障类型"
//						subscription: "Please choose at least one option",
//						gender: "Please choose gender",
//						agree: "Please accept our policy"
					},

					highlight: function (e) {
						$(e).closest('.form-group').removeClass('has-info').addClass('has-error');
					},

					success: function (e) {
						$(e).closest('.form-group').removeClass('has-error');//.addClass('has-info');
						$(e).remove();
					},

					errorPlacement: function (error, element) {
						error.insertAfter(element.parent());
					},

					submitHandler: function (form) {
					},
					invalidHandler: function (form) {
					}
				});

				var options = {
					chart: {
						renderTo: 'chartPanel',
						type: 'spline'
					},
					global : { useUTC : false },
					title: {
						text: 'MOMO生产日表',
						x: -20 //center
					},
					subtitle: {
						text: '',
						x: -20
					},
					xAxis: {
						tickInterval : 50,
						tickmarkPlacement : 'on',
						plotBands: [
							{
								label:{
									id: 'plot1'
								},
								events:{

								}
							},
							{
								label:{
									id: 'plot2'
								},
								events:{

								}
							},
							{
								label:{
									id: 'plot3'
								},
								events:{

								}
							}
						],
						type: 'datetime',
						dateTimeLabelFormats: { // don't display the dummy year
							hour: '%Y-%m-%d %H:%M:'
						},
						labels: {
							format: '{value:%H:%M}',
							align: 'right'
						}
					},
					yAxis: {
						labels: {
							format: '{value}%'
						},
						title: {
							text: '产量'
						},
						plotLines:[{
							color:'red',           //线的颜色，定义为红色
							dashStyle:'solid',     //默认值，这里定义为实线
//                        value:100,               //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
							width:4               //标示线的宽度，4px
						}]
					},
					plotOptions: {
						spline: {
							marker: {
								radius: 1,
//                            lineColor: '#666666',
								lineWidth: 1
							} },
						series : {
							events:{

							}
						}
					},
					tooltip:{
//                    formatter:function(){
//                        return '<b>' + this.series.name + '</b>: y=' + this.y + ', extra='+this.point.p;
//                    }
						shared : true
					},
					legend: {
						layout: 'vertical',
						align: 'right',
						verticalAlign: 'middle',
						borderWidth: 0
					},
					series: [
						{color: '#4572A7'},
						{color: '#89A54E'}
					]
				};

				queryData(options, endDate);

				//按钮注册事件 包含提交插入停台, 更新 删除 操作
				$("#btnClose").click(function(e){
					//重置评分控件 默认是三颗星
					starOptions.score = 3;
					$("#divRating").raty(starOptions);
					$("#formBreakdown")[0].reset();
					validator.resetForm();
					$("#breakModal").modal('hide');
				});
				//提交插入停台信息
				$('#btnSubmit').click(function(e){
					if(validator.form()){
						console.info("add new breakdown onSubmit validate status:" + validator.form());
						this.disabled = 'disabled';
						var vals = $("#formBreakdown").serialize();
						vals = "method=add&" + vals;
						var queryDate = $("#breakDayInfo").text();
						$.ajax({
							url:"/momo/addBreakdown",
							type:'post',
							dataType: "text",
							data: vals,
							contentType: "application/x-www-form-urlencoded; charset=UTF-8",
							complete : function(xhr, textStatus){
								console.info("btn add ajax complete,textStatus:" + textStatus + " data:" + this.data);
							},
							error : function (xhr, textStatus){
								console.info("btn add ajax error,textStatus:" + textStatus);
								$('#btnSubmit').removeAttr("disabled");
							},
							success:function(data){
//                        alert("submit: " + data);
								if(data == "success"){
									//成功插入信息 隐藏Model 清空数据 并且刷新数据
									$("#breakModal").modal('hide');
									//回复disabled状态
									$('#btnSubmit').removeAttr("disabled");
									starOptions.score = 3;
									$("#divRating").raty(starOptions);
									$("#formBreakdown")[0].reset();
									queryData(options , queryDate);
								}else{
									alert("some bad happens");
								}
							}});
					}else{
						console.info("add new breakdown onSubmit validate status:" + validator.form());
					}

				});

				//点击更新按钮
				$("#btnUpdate").click(function (e){
					if(validator.form()){
						this.disabled = 'disabled';
						var no = $("#btnUpdate").val();
						var vals = $("#formBreakdown").serialize();
						vals = "method=update&no=" + no + "&" + vals;
//                alert(vals);
						var queryDate = $("#breakDayInfo").text();
						if(no != ""){
							console.info("btnUpdate: vals" + vals);
							$.ajax({
								url:"/momo/addBreakdown",
								type:'post',
								dataType: "text",
								contentType: "application/x-www-form-urlencoded; charset=UTF-8",
								data: vals,
								complete : function(xhr, textStatus){
									console.info("btn update ajax complete,textStatus:" + textStatus + " data:" + this.data);
								},
								error : function (xhr, textStatus){
									console.info("btn update ajax error,textStatus:" + textStatus);
									$('#btnUpdate').removeAttr("disabled");
								},
								success: function(data){
//                            alert(data);
									if(data == "success"){
										$("#breakModal").modal('hide');
										$('#btnUpdate').removeAttr("disabled");
										starOptions.score = 3;
										$("#divRating").raty(starOptions);
										$("#formBreakdown")[0].reset();
										queryData(options , queryDate);
									}
								}
							});
						}
					}

				});


				//点击删除按钮
				$("#btnDelete").click(function (e){
					this.disabled = 'disabled';
					var no = $("#btnDelete").val();
					var queryDate = $("#breakDayInfo").text();
					if(no != ""){
						$.ajax({
							url:"/momo/addBreakdown",
							type:'post',
							dataType: "text",
							contentType: "application/x-www-form-urlencoded; charset=UTF-8",
							data: {no:no,method:'delete'},
							complete : function(xhr, textStatus){
								console.info("btn delete ajax complete,textStatus:" + textStatus + " data:" + this.data);
							},
							error : function (xhr, textStatus){
								console.info("btn delete ajax error,textStatus:" + textStatus);
							},
							success: function(data){
//                            alert(data);
								if(data == "success"){
									$("#breakModal").modal('hide');
									$('#btnDelete').removeAttr("disabled");
									starOptions.score = 3;
									$("#divRating").raty(starOptions);
									$("#formBreakdown")[0].reset();
									queryData(options , queryDate);
								}
							}
						});
					}
				});

				//停台信息中 严重级别 更新输入信息
				$("#starBreakLevel").on('starrr:change', function(e, value){
					$("#breakLevel").val(value);
				});
			});
			//ajax获取选定日期（queryDate)产量，并绘制图表
			function queryData(options ,queryDate){
				$.ajax({
					url:"/momo/queryTeamPC?method=query",
					type:'post',
					data: {endDate:queryDate},
					dataType: "json",
					complete : function(xhr, textStatus){
						console.info("queryData ajax complete,textStatus:" + textStatus + " data:" + this.data);
					},
					error : function (xhr, textStatus){
						console.info("queryData ajax error,textStatus:" + textStatus);
					},
					success:function(data, textStatus){
						console.info("queryData ajax success,textStatus:" + textStatus + " data.item;" + data.items.length + "data.records:" + data.records.length);
						if(data.items.length == 0){
							$("#msgDate").html(queryDate);
							$("#noDataMsg").show();
							$("#chartPanel").hide();
						}
						else{
							$("#chartPanel").show();
							$("#noDataMsg").hide();
							var tempStr_roa = "";
							var tempStr_opa = "";
							var production = data.items;
							//记录当天的计划产量与实际产出
							var plan = data.items[0]["plan"];
							var actual = 0;
							//读取该日期下所有的停台信息。
							var break_records = data.records;
							var break_records_num = data.records.length;
							var startLongTime = "";
							var endLongTime = "";
							for(var w=0;w<production.length;w++){
								val_actual.push(production[w]["actual"]);
								tempStr_opa = "{y:" +production[w]["opr"] + ",extra:" + production[w]["actual"]+ ",no:" + production[w]["no"] + ",seq:"+w + "}";
//                             tempStr_roa = "{y:" +production[w]["roa"] + ",extra:" + production[w]["actual"]+ ",no:" + production[w]["no"] + "}";
//                             val_opr.push(production[w]["opr"]);
//                             val_roa.push(production[w]["roa"]);
								//前台数据块 {y:100,extra:200,no:133231,index:59}
								tempStr_roa = "{y:";
								tempStr_roa += production[w]["roa"] + ",extra:" + production[w]["actual"]+ ",no:" + production[w]["no"] + ",seq:"+w;
								/*if(w >= 50 && w<=300){
								 //                                 tempStr_roa += ", marker: { symbol: 'url(../../img/sun_1.png)' }";
								 tempStr_roa += ", marker: { fillColor: 'red',lineColor: 'red',lineWidth: 1,radius:2}";
								 }*/
								tempStr_roa +="}";
								val_roa.push(tempStr_roa);
								val_opr.push(tempStr_opa);
								val_time.push("'" + production[w]["catchTime"] + "'");
								val_time_int.push(production[w]["catchTime"]);
								//记录查询开始的时间和结束时间 显示形式：毫秒
								if(w == 0){
									startLongTime = production[w]["catchTime"];
								}
								if(w == production.length-1){
									endLongTime = production[w]["catchTime"];
									actual = production[w]["actual"];
								}
							}
							options.series[0].name = "ROA";
							options.series[0].data = eval('['+ val_roa +']');
							options.series[1].name = "OPR";
							options.series[1].data = eval('['+ val_opr +']');
							options.xAxis.categories = eval('['+ val_time +']');
							options.yAxis.plotLines[0].value = 100;
							options.subtitle.useHTML = true;
							options.subtitle.text = queryDate + " 计划产量:" + "<span style='color: red'>" + plan + "</span>" + "台;实际产出:" +
									"<span style='color: red'>" + actual + "</span>" + "台";
							/*格式化提示框显示内容，增加当时产量信息*/
							options.tooltip.formatter = function(){
//                             var s = '<b>' + this.x + '</b>';
								var s = '<b>' + Highcharts.dateFormat('%Y-%m-%d %H:%M',this.x) + '</b>';
								$.each(this.points, function (index) {
									s += '<br/>' + this.series.name + ': ' +
											this.y + '%';
									if(index == 1){
										s += '<br/>' + 'Actual:' + this.point.extra + '台';
//                                     s += '<br/>' + 'NO:' + this.point.no;
//                                     s += '<br/>' + 'seq:' + this.point.seq;
									}
								});
								return s;
							};
							//注册点击事件，显示模态对话框，并且给对话框内元素赋值。
							options.plotOptions.series.events.click = function (event){
                             	console.info("the selected point x:"+event.point.x+" y:" + event.point.y + " no:" + event.point.no + " actual:" + event.point.y);
								console.info("time length: " + options.xAxis.categories.length + " val_time:" + options.xAxis.categories[event.point.x]);
								console.info("break_records_num:" + break_records_num);
								if ( break_records_num < 3)
								{
									//设置Model 中的日期时间 以及NO
									$("#breakModal").modal('show');
									var breakStartTime = getFormatUTCTime(eval(options.xAxis.categories[event.point.x]));
									var duration = setTimerDate(queryDate, options.xAxis.categories[event.point.x]);

									$("#breakDayInfo").html(queryDate);
									$("#breakScope").val(queryDate);
									$("#breakStartTime").val(breakStartTime);
									$("#breakNO").val(event.point.no);
									console.info("Onclick open modal add new breakdown record-breakStartTime:" + breakStartTime +" duration:" + duration + " " +
											"queryDate:" + queryDate);

									//绘制评分，设置当前评分
									starOptions.score = 3;
									$("#divRating").raty(starOptions);
									//新建一个停台记录 隐藏删除按钮
									$("#btnDelete").hide();
									$("#btnSubmit").show();
									$("#btnUpdate").hide();
								}
								else{
									alert("已达到当日最大创建停台记录，请删除以后记录重试")
								}
							};

							//在读取前，删除已有的停台信息;
							for (var w = 0;w < 3;w ++){
								options.xAxis.plotBands[w].from = 0;
								options.xAxis.plotBands[w].to = 0;
								options.xAxis.plotBands[w].color = '';
								options.xAxis.plotBands[w].label.text = '';
							}
							var color = "";
							for (var w = 0;w < break_records.length;w ++){
								var startTime = break_records[w]["startTime"];
								var endTime = break_records[w]["endTime"];
								var breakType = break_records[w]["breakType"];
								var breakName = break_records[w]["breakName"];
								var breakReason = break_records[w]["breakReason"];
								var duration = break_records[w]["duration"];
								var no = break_records[w]["no"]; // breakdown 的自增 主键
								var breakNO = break_records[w]["breakNO"];
								options.xAxis.plotBands[w].from = getIndexOfTimeArray(startTime);
								options.xAxis.plotBands[w].to = getIndexOfTimeArray(endTime);
								if(breakType == "1"){
									//红色
									options.xAxis.plotBands[w].color = 'rgba(255, 0, 0, 0.1)';
								}else if (breakType == "2"){
									//蓝色
									options.xAxis.plotBands[w].color = 'rgba(0, 0, 255, 0.1)';
								}else{
									//绿色
									options.xAxis.plotBands[w].color = 'rgba(0, 255, 0, 0.1)';
								}
								options.xAxis.plotBands[w].label.text = breakName;

								(function(){
									var p = w;
									options.xAxis.plotBands[w].events.click = function(e){
										$("#breakModal").modal('show');
										console.info("Enter plotBands click event");
										var startTime = break_records[p]["startTime"];
										var endTime = break_records[p]["endTime"];
										var breakType = break_records[p]["breakType"];
										var breakName = break_records[p]["breakName"];
										var breakReason = break_records[p]["breakReason"];
										var duration = break_records[p]["duration"];
										var no = break_records[p]["no"]; // breakdown 的自增 主键
										var breakNO = break_records[p]["breakNO"];
										var breakLevel = break_records[p]["breakLevel"];
                                   		/*为弹出的模态框一一赋值.*/
										//duration 控件显示分钟; breakDuration控件为hidden，记录停台的毫秒数，传给后台
										$("#duration").val(eval(duration/60000) + " Minute");
										$("#breakDuration").val(duration);

										$("#breakDayInfo").html(queryDate);
										$("#breakScope").val(queryDate);
										$("#breakStartTime").val(getFormatUTCTime(eval(startTime)));
										//breakEndTime 实际与timePickerBreakEndTime 控件表示一个值
										$("#breakEndTime").val(getFormatUTCTime(eval(endTime)));
										$("#timePickerBreakEndTime").val(getFormatUTCTime(eval(endTime)));
										$("#breakNO").val(breakNO);
										$("#breakReason").val(breakReason);
										$("#breakType option[value=" +breakType + "]").prop("selected",true);
										$("#breakLevel").val(breakLevel);

										//绘制评分，设置当前评分
										starOptions.score = breakLevel;
										$("#divRating").raty(starOptions);
										//显示删除按钮控件  paramId 记录删除所对应的no no是唯一主键
										$("#btnDelete").show();
										$("#btnSubmit").hide();
										$("#btnUpdate").show();
										$("#btnDelete").val(no);
										$("#btnUpdate").val(no);

										console.info("click model startTime:" + startTime + " endTime:" + endTime + " breakType:"+breakType + " breakName:" +
												breakName + " breakReason:" + breakReason + " duration:" + duration + " no:" + no +
												" breakNO:" + breakNO + " index:" + p + " breakLevel" + breakLevel);
									};

								})();
							}
							new Highcharts.Chart(options);
							val_actual = [];
							val_opr = [];
							val_roa = [];
							val_time = [];
							val_time_int = [];
						}
					}});
			}

			//根据给定的时间点(毫秒表示)，返回毫秒所表示的位置index
			function getIndexOfTimeArray(queryTime){
				var returnIndex = 0;
				while (queryTime > val_time_int[returnIndex])
				{
					returnIndex = returnIndex + 1;
				}
				return returnIndex;
			}

			//根据当天时间设置选择模态框内的日期控件 selecteDate:选择的某一天格式2014-10-14 selectedTimer: 当前选择的时间点14:31
			function setTimerDate(selectedDate, selectedTimer){

//				var selectedFormatDay = getQueryTodayTimeSpecify(selectedDate);
//				var selectedFormatTomorrow = getQueryTomorrowTimeSpecify(selectedDate);
				console.info("moment:" + moment(selectedDate,"YYYY-MM-DD") + " " + moment());
				var selectedFormatDay = moment(selectedDate,"YYYY-MM-DD").format('YYYY-MM-DD 08:00');
				var selectedFormatTomorrow = moment(selectedDate,"YYYY-MM-DD").add(1, 'd').format('YYYY-MM-DD 08:00');

//				var selectedFormatDay = "2016-02-18 08:00";
//				var selectedFormatTomorrow = "2016-02-19 08:00";

				var selectedDuration = "";
            	console.info("Method:setTimerDate()--selectedDate:" + selectedDate + " selectedFormatDay:" +
						selectedFormatDay + " selectedFormatTomorrow:" + selectedFormatTomorrow);
//				//日期插件 格式10:28
				$("#timePickerBreakEndTime").datetimepicker({
					format : 'YYYY-MM-DD HH:mm',
					defaultDate : selectedFormatTomorrow,
					sideBySide : true,
//					minDate : selectedFormatDay,
//					maxDate : selectedFormatTomorrow,
//					maxDate : "2014-09-19",
					focusOnShow : false
				}).on('dp.change', function(event){
					/*点击选则故障截止日期;如果选中的日期不在selectedFormatDay 与 selectedFormatTomorrow 之间
					* 则自动将日期添加为selectedFormatDay 或selectedFormatTomorrow*/
					var endSelectedTime;
					console.info("event.date:"+ event.date + "momment:" + moment(event.date,"YYYY-MM-DD HH:mm"));
					if(event.date <= NewDate(selectedFormatDay).getTime()){
						//选中的日期小于今天早班开始时间
						endSelectedTime = selectedFormatDay;
						$("#timePickerBreakEndTime").val(endSelectedTime);
					}else if(event.date >= NewDate(selectedFormatTomorrow).getTime()){
						endSelectedTime = selectedFormatTomorrow;
						$("#timePickerBreakEndTime").val(endSelectedTime);
					}else{
						endSelectedTime = moment(event.date).format("YYYY-MM-DD HH:mm");
					}
					$("#breakEndTime").val(endSelectedTime);
					var startTimer = $("#breakStartTime").val();
//					var endTimer = $("#breakEndTime").val();
					var longStartTime = NewDate(startTimer).getTime();
					var longEndTime = NewDate(endSelectedTime).getTime();
					var selectedDuration = eval(longEndTime - longStartTime);
					var mm = eval(selectedDuration/60000);
					console.info("breakEndTime:" + endSelectedTime + " duration:" + mm + " longStartTime:" + longStartTime +" longEndTime:" + longEndTime);
					$("#duration").val(mm + " Minute");
					$("#breakDuration").val(selectedDuration);
				});
				$("#timePickerBreakEndTime").val("");
				return selectedDuration;
			};
			/*
			*
			* 初始化停台信息表 查询breakDown表
			* */
			function initTableList(){
				tableBreakInfo = $("#tableBreakInfo").DataTable({
					"dom": '<"row"<"col-sm-8 "l><"col-sm-2 "f><"col-sm-2 "T>>t<"row"<"col-sm-6"i><"col-sm-6"p>>',
					oTableTools: {
						"aButtons": [
							{
								"sExtends": "copy",
								"sButtonText": "复制"
							},
							{
								"sExtends": "xls",
								"sButtonText": "导出"
							}
						]
					},
					"ajax": {
						"url" : "/momo/addBreakdown?method=query",
						"dataSrc" : "items"
					},
//					"bFilter" : false, //是否启动过滤、搜索功能
//					"bPaginate" : false, //是否显示（应用）分页器
//					"bInfo" : false, //是否显示页脚信息，DataTables插件左下角显示记录数
					//根据第四列用户的权限进行默认排序
//					"bSortClasses": true,
					"bProcessing":true,
					"bSort" : false, //是否启动各个字段的排序功能
					aaSorting : [[0, 'asc']],
					"columns": [
						{
							"data": "no",
							"sTitle" : "ID",
							"bVisible" : false
						},
						{
							"data": "breakScope",
							"sTitle" : "生产周数",
							"render": function(data, type, row) {
								var day = moment(data);
								return "KW" + day.format("WW");
							}
						},
						{
							"data": "breakScope",
							"sTitle" : "生产日期",
							"render": function(data, type, row) {
//								var day = moment(data);
//								return day.format("YYYY-MM-DD ddd");
								return data;
							}
						},
						{
							"data": "startTime",
							"sTitle" : "停台开始时间",
							"render": function(data, type, row) {
//								var day = moment(data);
//								return day.format("YYYY-MM-DD HH:MM");
								return data;
							}
						},
						{
							"data": "endTime",
							"sTitle" : "停台结束时间"
//							"render": function(data, type, row) {
////								var day = moment(new Date(data));
//								var day = moment(data);
//								return day.format("YYYY-MM-DD HH:MM");
//							}

						},
						{
							"data": "duration",
							"sTitle" : "停台时长",
							"render": function(data, type, row) {
								return data/1000/60 + " minutes";
								//TODO 时间格式错误
							}
						},
						{
							"data": "breakName",
							"sTitle" : "停台类型"
						},
						{
							"data": "breakReason",
							"sTitle" : "停台原因"
						}
					],
					"drawCallback": function( settings ) {
					}
				});

			}


		</script>

	</body>
</html>
