
<title>Blank Page - Ace Admin</title>
<meta charset="GBK" />
<script src="../js/highcharts.src.js" type="text/javascript"></script>
<script src="../assets/js/date-time/moment.js" type="text/javascript"></script>
<script src="../js/jsTool.js" type="text/javascript"></script>
<script src="../js/jquery.raty.js" type="text/javascript"></script>
<script src="../assets/js/date-time/bootstrap-datetimepicker.js" type="text/javascript"></script>
<link href="../css/jquery.raty.css" rel="stylesheet" type="text/css"/>
<script src="../js/jquery.blockUI.js" type="text/javascript"></script>

<link rel="stylesheet" href="../assets/css/bootstrap-datetimepicker.css" />

<!-- ajax layout which only needs content area -->
<!--<link rel="stylesheet" href="../css/bootstrap-datetimepicker.css">-->

<div class="row">
	<div class="col-xs-12">
		<!-- PAGE CONTENT BEGINS -->
		<form action="" class="form-horizontal"  role="form">
			<label for="query_date" class="col-md-2 control-label">选择日期</label>
			<div class="input-group col-md-4" >
				<!--<input class="form-control form_date" type="text" data-date=""-->
				<!--data-date-format="dd MM yyyy" data-link-field="query_date" data-link-format="yyyy-mm-dd">-->
				<!--<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>-->
				<!--<span class="input-group-addon"><span class="glyphicon glyphicon-search" id="btnSearch"></span></span>-->
				<input id="date-timepicker1" type="text" class="form-control" />
				<span class="input-group-addon"><i class="fa fa-clock-o bigger-110"></i></span>
				<span class="input-group-addon"><span class="glyphicon glyphicon-search" id="btnSearch"></span></span>
			</div>
		</form>
		<input type="hidden" id="query_date" name="query_date" value="" /><br/><br/>
		<form action="" class="form-horizontal"  role="form">
			<label for="query_date" class="col-md-2 control-label">选择日期</label>
			<div class="input-group col-md-4" >
				<!--<input class="form-control form_date" type="text" data-date=""-->
				<!--data-date-format="dd MM yyyy" data-link-field="query_date" data-link-format="yyyy-mm-dd">-->
				<!--<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>-->
				<!--<span class="input-group-addon"><span class="glyphicon glyphicon-search" id="btnSearch"></span></span>-->
				<input id="date-timepicker2" type="text" class="form-control" />
				<span class="input-group-addon"><i class="fa fa-clock-o bigger-110"></i></span>
			</div>
		</form>
		<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#breakModal">
			Launch momo modal
		</button>
		<!-- Modal -->

		<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

		<!-- PAGE CONTENT ENDS -->
	</div><!-- /.col -->
</div><!-- /.row -->
<!--Model for break down information Start-->
<div class="modal fade" id="breakModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
				<h4 class="modal-title" id="myModalLabel">
					<label id="breakDayInfo"></label> 添加异常信息
				</h4>
			</div>
			<div class="modal-body">
				<form action="" class="form-horizontal" id="formBreakdown" method="post"  role="form">
					<fieldset>
						<div class="form-group">
							<label for="breakStartTime" class="col-md-3 control-label">Start Time</label>
							<div class="col-md-6">
								<input class="form-control" id="breakStartTime" name="breakStartTime" type="text" value="" readonly/>
							</div>
						</div>
						<div class="form-group">
							<label for="endTime" class="col-md-3 control-label">End Time</label>
							<div class="col-md-9">
								<!--<div class="input-group date form_time col-md-6" id="timePicker"-->
									 <!--data-date="" data-date-format="yyyy-mm-dd hh:ii"-->
									 <!--data-link-field="breakEndTime" data-link-format="yyyy-mm-dd hh:ii">-->
									<!--<input class="form-control" size="50" type="text" value="" id="endTime">-->
									<!--<span class="input-group-addon"><span class="glyphicon glyphicon-time"></span></span>-->
								<!--</div>-->
								<div class="input-group col-md-6" >
									<input id="date-timepicker3" type="text" class="form-control" id="endTime"/>
									<span class="input-group-addon"><i class="fa fa-clock-o bigger-110"></i></span>
								</div>
								<input type="hidden" id="breakEndTime" value=""  name="breakEndTime"/>
								<input type="hidden" id="breakNO" value=""  name="breakNO"/>
								<input type="hidden" id="breakScope" value=""  name="breakScope"/>
							</div>
						</div>
						<div class="form-group">
							<label for="duration" class="col-md-3 control-label">Duration</label>
							<div class="col-md-6">
								<input class="form-control" id="duration" name="duration" type="text" disabled/>
								<input type="hidden" id="breakDuration" value=""  name="breakDuration"/>
							</div>
						</div>
						<div class="form-group">
							<label for="duration" class="col-md-3 control-label">Level</label>
							<div class="col-md-6">
								<div id="divRating" data-score="3"></div><div id="hint"></div>
							</div>
							<input type='hidden' name='breakLevel' id="breakLevel" value='3' />
						</div>
						<div class="form-group">
							<label class="col-md-3 control-label">Type</label>
							<div class="col-md-6 controls">
								<select id="breakType" name="breakType" class="form-control">
									<option value="">请选择</option>
									<option value="1">设备故障</option>
									<option value="2">物料短缺</option>
									<option value="3">其他</option>
								</select>
							</div>
						</div>
						<div class="form-group">
							<label class="col-md-3 control-label" for="breakReason">Reason</label>
							<div class="col-md-9 controls">
								<input placeholder="Reason for Breakdown" class="form-control" id="breakReason" type="text"
									   name="breakReason" maxlength="50">
							</div>
						</div>
					</fieldset>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn " data-dismiss="modal" id="btnClose">Close</button>
				<button type="button" class="btn btn-primary" id="btnSubmit" name="btnSubmit">Add</button>
				<button type="button" class="btn btn-primary" id="btnDelete"  value="">Delete</button>
				<button type="button" class="btn btn-danger" id="btnUpdate"  value="">Update</button>
			</div>
		</div>
	</div>
</div>
<!--Model for break down information End-->
<!-- page specific plugin scripts -->
<script type="text/javascript">
//	var scripts = [null,
//		"../assets/js/date-time/moment.min.js",
//		"../assets/js/date-time/bootstrap-datetimepicker.min.js",
//		null];
	var scripts = [null, null]
	ace.load_ajax_scripts(scripts, function() {
	  //inline scripts related to this page
//		$.blockUI.defaults.message = '<h4><img style="height: 30px;width: 30px" src="../img/loading.gif" /> Just a moment...</h4>';
//		$.blockUI.defaults.overlayCSS.opacity = .2;
//		$(document).ajaxStart($.blockUI).ajaxStop($.unblockUI);
		$(function () {
			//获取昨天的日期，默认查询昨天的产量；日期搜索提供一年的时间跨度，由于数据库分表的问题。
			var today = new Date();
			var longToday  = Date.UTC(today.getFullYear(), today.getMonth(), today.getDate());
			var yesterday = new Date(longToday - 86400000);
			var month = yesterday.getMonth() + 1;
			var endDate = yesterday.getFullYear()+"-"+month+"-"+yesterday.getDate();
			var startYear = today.getFullYear() + "-01-01";
			var endYear = today.getFullYear() + "-12-31";

			//日期插件 格式2014-10-12
			$('#date-timepicker1').datetimepicker({
				format : 'YYYY-MM-DD dddd',
				viewMode : 'days',
				showClose : true,
				calendarWeeks : true,
				showTodayButton : true,
				maxDate : endYear,
				minDate : startYear
			}).on("dp.change", function (e){
				console.info("datetimepicker on change event: " + moment(e.date).format("YYYY-MM-DD"));
				$("#query_date").val(moment(e.date).format("YYYY-MM-DD"));
			});

			$('#date-timepicker2').datetimepicker({
				format : 'YYYY-MM-DD HH:mm',
				defaultDate : moment(),
				sideBySide : true,
				minDate : getQueryTodayTimeSpecify("2015-11-20"),
				maxDate : getQueryTomorrowTimeSpecify("2015-11-20"),
				focusOnShow : false
//				viewMode : 'days',
//				showClose : true,
//				calendarWeeks : true
			});

			$('#date-timepicker3').datetimepicker({
				format : 'YYYY-MM-DD HH:mm',
				defaultDate : moment(),
				sideBySide : true,
				minDate : getQueryTodayTimeSpecify("2015-11-20"),
				maxDate : getQueryTomorrowTimeSpecify("2015-11-20"),
				focusOnShow : false
//				viewMode : 'days',
//				showClose : true,
//				calendarWeeks : true
			}).on('dp.change', function(event){
//                alert($("#breakEndTime").val());
				$("#breakEndTime").val(moment(event.date).format("YYYY-MM-DD HH:mm"));
				var startTimer = $("#breakStartTime").val();
				var endTimer = $("#breakEndTime").val();
				var longStartTime = NewDate(startTimer).getTime();
				var longEndTime = NewDate(endTimer).getTime();
				var selectedDuration = eval(longEndTime - longStartTime);
				var mm = eval(selectedDuration/60000);
				console.info("breakEndTime:" + endTimer + " duration:" + mm);
				$("#duration").val(mm + " Minute");
				$("#breakDuration").val(selectedDuration);
			});
			var starOptions = {
				score: 3,
				path:  "../img",
				hints: ['一般','严重', '一般严重', '非常严重', '极其严重'],
				target : '#hint',
				targetKeep : true,
				click: function(score, evt) {
//                    alert('ID: ' + this.id + "\nscore: " + score + "\nevent: " + evt);
					$("#breakLevel").val(score);
				}
			};

			//评分插件
			$("#divRating").raty(starOptions);
			$("#btnSearch").click(function(){
				//endDate 是查询的日期
				var endDate = $("#query_date").val();
				console.info("endDate:" + endDate);
				//弹出遮罩层
//                $.blockUI();
//				queryData(options , endDate);
			});
			var options = {
				chart: { type: 'spline' },
				title: { text: 'Snow depth at Vikjafjellet, Norway' },
				subtitle: {
					text: 'Irregular time data in Highcharts JS' },
				xAxis: {  },
				yAxis: { title: { text: 'Snow depth (m)' }, min: 0 },
				tooltip: { formatter:
						function() {
							return '<b>'+ this.series.name +'</b><br>'+ Highcharts.dateFormat('%e. %b', this.x) +': '+ this.y +' m'; } },
				series: [{
					name: 'Winter 2007-2008',
					data: [
						[Date.UTC(1970,  9, 27), 0   ],
						[Date.UTC(1970, 10, 10), 0.6 ],
						[Date.UTC(1970, 10, 18), 0.7 ],
						[Date.UTC(1970, 11,  2), 0.8 ],
						[Date.UTC(1970, 11,  9), 0.6 ],
						[Date.UTC(1970, 11, 16), 0.6 ],
						[Date.UTC(1970, 11, 28), 0.67],
						[Date.UTC(1971,  0,  1), 0.81],
						[Date.UTC(1971,  0,  8), 0.78],
						[Date.UTC(1971,  0, 12), 0.98],
						[Date.UTC(1971,  0, 27), 1.84],
						[Date.UTC(1971,  1, 10), 1.80],
						[Date.UTC(1971,  1, 18), 1.80],
						[Date.UTC(1971,  1, 24), 1.92],
						[Date.UTC(1971,  2,  4), 2.49],
						[Date.UTC(1971,  2, 11), 2.79],
						[Date.UTC(1971,  2, 15), 2.73],
						[Date.UTC(1971,  2, 25), 2.61],
						[Date.UTC(1971,  3,  2), 2.76],
						[Date.UTC(1971,  3,  6), 2.82],
						[Date.UTC(1971,  3, 13), 2.8 ],
						[Date.UTC(1971,  4,  3), 2.1 ],
						[Date.UTC(1971,  4, 26), 1.1 ],
						[Date.UTC(1971,  5,  9), 0.25],
						[Date.UTC(1971,  5, 12), 0   ]

					]
				}],
				plotOptions: {
					spline: {
						marker: {
							radius: 1,
//                            lineColor: '#666666',
							lineWidth: 1
						} },
					series : {
						events:{

						}
					}
				}
			};
			options.plotOptions.series.events.click = function (event){
					//设置Model 中的日期时间 以及NO
					$("#breakModal").modal('show');
					var breakStartTime = "2015-11-20 08:55";
//					var duration = setTimerDate(queryDate, options.xAxis.categories[event.point.x]);

//					$("#breakDayInfo").html(queryDate);
//					$("#breakScope").val(queryDate);
					$("#breakStartTime").val(breakStartTime);
//					$("#breakNO").val(event.point.no);
					//绘制评分，设置当前评分
					starOptions.score = 3;
					$("#divRating").raty(starOptions);
					//新建一个停台记录 隐藏删除按钮
					$("#btnDelete").hide();
					$("#btnSubmit").show();
					$("#btnUpdate").hide();
			};
			$('#container').highcharts(options);

		});
	});
</script>
